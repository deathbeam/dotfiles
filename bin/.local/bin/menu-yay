#!/bin/sh

fifo=$(mktemp -u)
mkfifo "$fifo"

# Print installed packages in yellow immediatelly
yay -Qq | awk '{print "\033[0;33m" $0 "\033[0m"}' > "$fifo" &

# Print available packages in background, excluding installed ones
(yay -Slq | grep -vxFf <(yay -Qq) >> "$fifo") &

pkg=$(cat "$fifo" | fzfmenu -p "yay" --ansi --preview="yay -Si {1}")
rm "$fifo"

[ -z "$pkg" ] && exit 1

name=$(echo "$pkg" | awk '{print $1}')

if yay -Qq | grep -qx "$name"; then
    action="Uninstalling"
    cmd="yay -Rns $name"
else
    action="Installing"
    cmd="yay -S $name"
fi

$TERMINAL -e "$SHELL" -ic "echo '$action $name...'; $cmd; echo; read 'REPLY?Press enter to exit...'"
